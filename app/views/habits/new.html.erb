<%# 新規習慣作成ページ %>
<%# このファイルは HabitsController の new アクション（GET /habits/new）で表示される %>

<%# メインコンテナ %>
<%# max-w-2xl: 最大幅 672px %>
<%#   - 2xl = extra extra large %>
<%#   - ログイン（max-w-md: 448px）より広く、一覧（max-w-7xl: 1280px）より狭い %>
<%#   - フォームの入力欄が広すぎず、かつ説明文が読みやすい幅 %>
<%# mx-auto: margin-left と margin-right を auto に設定 %>
<%#   - 左右のマージンを自動計算して中央揃えにする %>
<%#   - mx = margin-x（x軸、つまり水平方向） %>
<%# px-4 sm:px-6 lg:px-8: 左右のパディング（レスポンシブ対応） %>
<%#   - px-4: デフォルト（モバイル）は左右パディング 16px %>
<%#     - 画面幅が狭いモバイルでは、コンテンツが画面端にくっつかないように余白を確保 %>
<%#   - sm:px-6: 画面幅 640px 以上（タブレット）は左右パディング 24px %>
<%#     - sm = small（Tailwind CSS のブレークポイント） %>
<%#     - タブレットでは少し余白を広げる %>
<%#   - lg:px-8: 画面幅 1024px 以上（PC）は左右パディング 32px %>
<%#     - lg = large %>
<%#     - PCでは更に余白を広げる %>
<%#   - レスポンシブデザイン: 画面サイズに応じて自動調整される %>
<%# py-8: 上下のパディング 32px %>
<%#   - py = padding-y（y軸、つまり垂直方向） %>
<%#   - ヘッダーとフッターの間にコンテンツが窮屈にならないように余白を作る %>
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <%# ページタイトル（h2タグ） %>
  <%# text-2xl: フォントサイズ 24px %>
  <%#   - 2xl = extra extra large %>
  <%#   - Tailwind CSS のフォントサイズは xs, sm, base, lg, xl, 2xl, 3xl... と段階的に大きくなる %>
  <%#   - ページタイトルとして適度な大きさ %>
  <%# font-bold: フォントウェイト 700（太字） %>
  <%#   - normal(400), medium(500), semibold(600), bold(700), extrabold(800) などがある %>
  <%#   - タイトルは太字にすることで階層構造を明確にする %>
  <%# mb-6: 下マージン 24px %>
  <%#   - mb = margin-bottom %>
  <%#   - タイトルとフォームの間に適切な余白を作る %>
  <%#   - 6 は 24px（Tailwind CSS では 1単位 = 4px） %>
  <%# text-gray-900: テキスト色（濃いグレー、ほぼ黒） %>
  <%#   - gray-50（最も薄い）から gray-900（最も濃い）まで段階がある %>
  <%#   - 900 は最も濃いグレーで、タイトルに適している %>
  <h2 class="text-2xl font-bold mb-6 text-gray-900">
    新しい習慣を追加
  </h2>

  <%# form_with: Rails のフォームヘルパー %>
  <%#   - HTMLフォームを簡単に作成できる Rails 標準のヘルパーメソッド %>
  <%#   - セキュリティ（CSRF対策）やバリデーションエラーの再表示を自動で処理 %>
  <%# model: @habit => フォームが @habit オブジェクトに紐づく %>
  <%#   - @habit: コントローラーで作成されたインスタンス変数 %>
  <%#   - @habit が新規レコード（id がない）→ POST /habits に送信 %>
  <%#   - @habit が既存レコード（id がある）→ PATCH /habits/:id に送信（Rails が自動判別） %>
  <%#   - この仕組みにより、新規作成と編集で同じフォームを使い回せる %>
  <%# local: true => 非同期送信を無効化（通常のHTMLフォームとして動作） %>
  <%#   - デフォルトでは Turbo（非同期通信）が有効 %>
  <%#   - local: true にすると通常のHTMLフォーム送信（ページ遷移あり）になる %>
  <%= form_with model: @habit, local: true do |f| %>
    
    <%# エラーメッセージ表示エリア %>
    <%# @habit.errors.any?: バリデーションエラーがあるか判定 %>
    <%#   - @habit: コントローラーから渡された Habit オブジェクト %>
    <%#   - errors: ActiveModel::Errors オブジェクト（バリデーションエラーを保持） %>
    <%#   - any?: エラーが1件以上あるか判定するメソッド %>
    <%#   - バリデーション失敗時（@habit.save が false を返した時）に自動的にエラーがセットされる %>
    <% if @habit.errors.any? %>
      <%# エラーボックス（赤色の警告エリア） %>
      <%# bg-red-50: 薄い赤背景 %>
      <%#   - bg = background（背景色） %>
      <%#   - red-50: 最も薄い赤（50〜900 の10段階） %>
      <%#   - エラーメッセージの背景として、目立ちすぎず、かつ注意を引く色 %>
      <%# border-l-4: 左ボーダー 4px %>
      <%#   - border-l = border-left（左側のボーダー） %>
      <%#   - 4 は 4px の太さ（Tailwind CSS では 1 = 1px、2 = 2px、4 = 4px） %>
      <%#   - 左側に太いボーダーを付けることで、エラーボックスを視覚的に強調 %>
      <%#   - Material Design などでよく使われるデザインパターン %>
      <%# border-red-500: ボーダー色（赤） %>
      <%#   - red-500: 中間の明るさの赤 %>
      <%#   - 薄い赤背景に濃い赤ボーダーでコントラストを出す %>
      <%# p-4: 全方向のパディング 16px %>
      <%#   - p = padding（上下左右すべて） %>
      <%#   - 4 は 16px（Tailwind CSS では 1単位 = 4px なので、4 × 4 = 16px） %>
      <%#   - エラーメッセージが枠線にくっつかないように内側に余白を作る %>
      <%# mb-6: 下マージン 24px %>
      <%#   - mb = margin-bottom %>
      <%#   - エラーボックスとフォームの間に余白を作る %>
      <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
        <%# エラー件数の見出し %>
        <%# text-red-800: テキスト色（濃い赤） %>
        <%#   - red-800: 800 は濃いめの赤（900 に次いで濃い） %>
        <%#   - 薄い赤背景（red-50）に濃い赤文字（red-800）でコントラストを出す %>
        <%# font-bold: フォントウェイト 700（太字） %>
        <%#   - エラー件数は重要な情報なので太字にする %>
        <%# mb-2: 下マージン 8px %>
        <%#   - 見出しとエラーメッセージリストの間に余白 %>
        <h3 class="text-red-800 font-bold mb-2">
          <%# @habit.errors.count: エラーの件数を取得 %>
          <%#   - count メソッドでエラーの総数を数える %>
          <%#   - 例: 2件のエラーがある場合は 2 が返る %>
          <%= @habit.errors.count %> 件のエラーがあります
        </h3>
        
        <%# エラーメッセージのリスト %>
        <%# list-disc: リストスタイルを「●」（ディスク）にする %>
        <%#   - disc = 黒い丸（●）、circle（○）、square（■）などがある %>
        <%#   - HTML の <ul> タグのデフォルトスタイル %>
        <%# list-inside: リストマーカー（●）をリスト項目の内側に配置 %>
        <%#   - inside: マーカーがテキストと同じ行に表示される %>
        <%#   - outside（デフォルト）: マーカーがテキストの左側にインデントされる %>
        <%# text-red-700: テキスト色（赤） %>
        <%#   - red-700: 濃いめの赤（800 より少し薄い） %>
        <%# text-sm: フォントサイズ 14px %>
        <%#   - sm = small %>
        <%#   - エラーメッセージは見出しより小さめにする %>
        <ul class="list-disc list-inside text-red-700 text-sm">
          <%# @habit.errors.full_messages: すべてのエラーメッセージを配列で取得 %>
          <%#   - full_messages: "Name can't be blank" のような完全な文章を返す %>
          <%#   - messages だと "can't be blank" だけが返る（属性名なし） %>
          <%#   - 例: ["Name can't be blank", "Weekly target must be greater than or equal to 1"] %>
          <%# each: 配列の各要素に対してループ処理 %>
          <%# do |message|: 各要素を message 変数として受け取る %>
          <% @habit.errors.full_messages.each do |message| %>
            <%# 各エラーメッセージをリスト項目（<li>）として表示 %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%# 習慣名入力フィールド %>
    <%# mb-6: 下マージン 24px %>
    <%#   - 各入力フィールド間の余白 %>
    <div class="mb-6">
      <%# label タグ: 入力欄のラベル %>
      <%# f.label :name: name フィールドのラベルを自動生成 %>
      <%#   - f: form_with ブロックのフォームビルダーオブジェクト %>
      <%#   - :name: Habit モデルの name 属性 %>
      <%# "習慣名": ラベルのテキスト（日本語表示） %>
      <%#   - 指定しない場合は "Name" という英語ラベルになる %>
      <%# class で Tailwind CSS を適用: %>
      <%#   block: ブロック要素として表示（改行される） %>
      <%#     - デフォルトの label はインライン要素（横並び） %>
      <%#     - block にすることで、ラベルと入力欄が縦に並ぶ %>
      <%#   text-sm: フォントサイズ 14px %>
      <%#     - ラベルは本文より小さめにするのが一般的 %>
      <%#   font-medium: フォントウェイト 500（中太） %>
      <%#     - normal(400) より少し太く、bold(700) より少し細い %>
      <%#     - ラベルとして適度な強調 %>
      <%#   text-gray-700: テキスト色（グレー） %>
      <%#     - 700 は濃いめのグレーで、ラベルに適している %>
      <%#   mb-2: 下マージン 8px %>
      <%#     - ラベルと入力欄の間の余白 %>
      <%= f.label :name, "習慣名", class: "block text-sm font-medium text-gray-700 mb-2" %>
      
      <%# text_field: テキスト入力欄 %>
      <%# f.text_field :name: name 属性の入力欄を生成 %>
      <%#   - type="text" の input タグが生成される %>
      <%#   - name="habit[name]" という name 属性が自動的に付与される %>
      <%#   - フォーム送信時に params[:habit][:name] として受け取れる %>
      <%# placeholder: 入力例を表示（グレーの薄い文字） %>
      <%#   - ユーザーが何を入力すべきかのヒント %>
      <%#   - 入力を開始すると自動的に消える %>
      <%#   - 複数の例を示すことで、ユーザーにイメージを伝えやすくする %>
      <%# class で入力欄のスタイルを指定: %>
      <%#   w-full: 幅 100% %>
      <%#     - w = width %>
      <%#     - 親要素の幅いっぱいに広がる %>
      <%#     - レスポンシブデザインで必須 %>
      <%#   px-4: 左右パディング 16px %>
      <%#     - 入力欄の内側の左右余白 %>
      <%#     - テキストが枠線にくっつかないようにする %>
      <%#   py-2: 上下パディング 8px %>
      <%#     - 入力欄の内側の上下余白 %>
      <%#     - 入力欄の高さを適切にする %>
      <%#   border: ボーダー 1px %>
      <%#     - デフォルトでは枠線がないので、border を指定 %>
      <%#   border-gray-300: ボーダー色（グレー） %>
      <%#     - 300 は薄めのグレーで、枠線に適している %>
      <%#     - 濃すぎると圧迫感がある %>
      <%#   rounded-md: 角丸 6px %>
      <%#     - md = medium %>
      <%#     - sm(4px), md(6px), lg(8px), xl(12px) などがある %>
      <%#     - 角を丸くすることで柔らかい印象になる %>
      <%#   focus:ring-2: フォーカス時（クリック時）にリング（枠線）2px %>
      <%#     - focus: はフォーカス時（クリック時、タブキーでの選択時）に適用される擬似クラス %>
      <%#     - ring はボーダーの外側に表示される影のような線 %>
      <%#     - 2 は 2px の太さ %>
      <%#   focus:ring-blue-500: リングの色（青） %>
      <%#     - 500 は中間の明るさの青 %>
      <%#     - 入力欄がアクティブであることを視覚的に示す %>
      <%#   focus:border-blue-500: フォーカス時のボーダー色（青） %>
      <%#     - border-gray-300 から border-blue-500 に変わる %>
      <%#     - リングと同じ色にすることで統一感を出す %>
      <%= f.text_field :name, 
          placeholder: "例: 読書、筋トレ、英語学習", 
          class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      
      <%# ヘルプテキスト（入力のヒント） %>
      <%# mt-2: 上マージン 8px %>
      <%#   - 入力欄とヘルプテキストの間の余白 %>
      <%# text-sm: フォントサイズ 14px %>
      <%#   - ヘルプテキストは小さめにする %>
      <%# text-gray-500: テキスト色（グレー） %>
      <%#   - 500 は中間のグレーで、補足テキストに適している %>
      <%#   - 700 より薄いので、主要なテキストより目立たない %>
      <p class="mt-2 text-sm text-gray-500">
        習慣名は50文字以内で入力してください
      </p>
    </div>

    <%# 週次目標値入力フィールド %>
    <div class="mb-6">
      <%= f.label :weekly_target, "週次目標値", class: "block text-sm font-medium text-gray-700 mb-2" %>
      
      <%# number_field: 数値入力欄（スピンボタン付き） %>
      <%# f.number_field :weekly_target: weekly_target 属性の数値入力欄を生成 %>
      <%#   - type="number" の input タグが生成される %>
      <%#   - ブラウザが数値のみを受け付ける（文字入力は不可） %>
      <%#   - スピンボタン（▲▼）が表示される %>
      <%# min: 最小値（1以上） %>
      <%#   - ブラウザレベルで最小値をチェック %>
      <%#   - ユーザーが 0 や負の数を入力できないようにする %>
      <%#   - ただし、手動で 0 を入力することは可能なので、サーバー側バリデーションも必要 %>
      <%# max: 最大値（7以下）※ 週7日なので上限7 %>
      <%#   - ブラウザレベルで最大値をチェック %>
      <%#   - ユーザーが 8 以上を入力できないようにする %>
      <%# value: 初期値の設定 %>
      <%#   - f.object: フォームに紐づいた @habit オブジェクト %>
      <%#   - f.object.weekly_target: @habit.weekly_target を取得 %>
      <%#   - || 7: weekly_target が nil の場合はデフォルト値 7 を使用 %>
      <%#   - これにより、新規作成時は 7 が、バリデーションエラー後は入力値が表示される %>
      <%# placeholder: 入力例を表示 %>
      <%= f.number_field :weekly_target, 
          min: 1, 
          max: 7, 
          value: f.object.weekly_target || 7,
          placeholder: "例: 7（週7回実施）", 
          class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      
      <%# ヘルプテキスト %>
      <p class="mt-2 text-sm text-gray-500">
        週あたりの実施回数を設定します（1〜7回）
      </p>
    </div>

    <%# ボタンエリア %>
    <%# flex: フレックスボックス（横並び） %>
    <%#   - デフォルトでは縦並び（ブロック要素）だが、flex にすることで横並びになる %>
    <%# gap-4: 要素間の隙間 16px %>
    <%#   - gap は flex や grid レイアウトで使える便利なプロパティ %>
    <%#   - 各ボタン間に自動的に余白が入る %>
    <%#   - margin を個別に指定する必要がない %>
    <div class="flex gap-4">
      <%# キャンセルボタン %>
      <%# link_to: リンクを生成する Rails ヘルパー %>
      <%# "キャンセル": リンクのテキスト %>
      <%# habits_path: /habits への名前付きルート（習慣一覧ページ） %>
      <%# class で Tailwind CSS を適用: %>
      <%#   flex-1: フレックスアイテムとして幅を均等に配分 %>
      <%#     - キャンセルボタンと登録ボタンが同じ幅になる %>
      <%#     - flex-1 は flex-grow: 1 の省略形 %>
      <%#   px-4 py-2: パディング %>
      <%#   bg-gray-200: 背景色（グレー） %>
      <%#     - キャンセルボタンは目立たせない %>
      <%#     - 主要なアクション（登録）を強調するため %>
      <%#   text-gray-700: テキスト色（濃いグレー） %>
      <%#   rounded-md: 角丸 6px %>
      <%#   hover:bg-gray-300: ホバー時に背景色を濃く %>
      <%#     - ボタンがインタラクティブであることを示す %>
      <%#   transition: アニメーション効果（滑らかに変化） %>
      <%#     - 色の変化が瞬間的ではなく、0.3秒かけて滑らかに変わる %>
      <%#   text-center: テキスト中央揃え %>
      <%#     - link_to はデフォルトで左揃えなので、中央揃えにする %>
      <%= link_to "キャンセル", habits_path, 
          class: "flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition text-center" %>
      
      <%# 登録ボタン %>
      <%# f.submit: フォーム送信ボタン %>
      <%# "登録する": ボタンのラベル %>
      <%#   - submit ボタンは type="submit" の button タグが生成される %>
      <%#   - クリックするとフォームが送信される %>
      <%# class で Tailwind CSS を適用: %>
      <%#   flex-1: キャンセルボタンと同じ幅にする %>
      <%#   bg-blue-600: 背景色（青） %>
      <%#     - 主要なアクション（Call to Action）は青にする %>
      <%#     - ユーザーの目を引き、クリックを促す %>
      <%#   text-white: テキスト色（白） %>
      <%#     - 青い背景に白文字で見やすく %>
      <%#   hover:bg-blue-700: ホバー時に背景色を濃く %>
      <%#     - ボタンがクリック可能であることを示す %>
      <%= f.submit "登録する", 
          class: "flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition" %>
    </div>
  <% end %>
</div>